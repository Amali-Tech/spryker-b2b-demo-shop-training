{% extends model('component') %}

{% define config = {
    name: 'cart-item-note',
    tag: 'cart-item-note'
} %}

{% define data = {
    form: {},
    canWrite: required,
    label: '',
    note: ''
} %}

{% define attributes = {
    'edit-button-selector': '.js-' ~ config.name ~ '__edit',
    'remove-button-selector': '.js-' ~ config.name ~ '__remove',
    'read-section-selector': '.js-' ~ config.name ~ '__text-wrap',
    'form-selector': '.js-' ~ config.name ~ '__form',
    'change-class': 'is-hidden'
} %}

{% block body %}

    {% set title = data.label is not empty ? data.label : 'cart_note.form.comment' %}
    {% set note = data.note is not empty ? data.note : data.form.vars.value.cartNote %}
    {% set isNoteNotEmpty = data.isNoteNotEmpty is defined ? data.isNoteNotEmpty : (data.form.vars.value.cartNote is not null and data.form.vars.value.cartNote is not empty) %}

    {% if data.canWrite or isNoteNotEmpty %}

        {% if isNoteNotEmpty %}
            <h6 class="{{ config.name }}__title">{{ title | trans }}:</h6>
        {% endif %}

        <div class="{{ config.name }}__container">

            {% if isNoteNotEmpty %}
                <div class="{{ config.name }}__text-wrap js-{{ config.name }}__text-wrap">
                    <div class="{{ config.name }}__text">{{ note }}</div>

                    {% if data.canWrite %}
                        {% include molecule('cart-item-note-actions', 'CartNoteWidget') with {
                            data: {
                                buttons: [{
                                    class: 'link link--icon js-' ~ config.name ~ '__edit',
                                    icon: 'edit',
                                    text: 'cart_note.form.edit_comment' | trans
                                },
                                {
                                    class: 'link link--icon js-' ~ config.name ~ '__remove',
                                    icon: 'delete',
                                    text: 'cart_note.form.remove_comment' | trans
                                }]
                            }
                        } only %}
                    {% endif %}
                </div>
            {% endif %}

            {% if data.canWrite %}
                {% set pefixForJs = data.form.vars.value.groupKey | replace({"." : ""}) %}

                <div class="{{ config.name }}__form js-{{ config.name }}__form js-{{ config.name }}__form--{{ pefixForJs }} {% if isNoteNotEmpty %}is-hidden{% endif %}">
                    <h6 class="{{ config.name }}__label toggler-accordion__item js-{{ config.name }}__trigger {% if isNoteNotEmpty %}active{% endif %}" data-toggle-target='.js-{{ config.name }}__content--{{ pefixForJs }}'>
                        {{ 'cart_note.form.add_comment' | trans }}
                        <span class="icon icon--toggler-cross icon--toggler-cross-link toggler-accordion__icon"></span>
                    </h6>
                    <div class="{{ config.name }}__content js-{{ config.name }}__content js-{{ config.name }}__content--{{ pefixForJs }} {% if not isNoteNotEmpty %}is-hidden{% endif %}">
                        {% include molecule('form') with {
                            data: {
                                form: data.form,
                                options: {
                                    action: url('cart-note/item')
                                },
                                submit: {
                                    enable: true,
                                    text: 'cart_note.form.save' | trans
                                }
                            }
                        } only %}
                    </div>
                </div>

                {% include molecule('toggler-accordion') with {
                    attributes: {
                        'wrap-selector': '.js-' ~ config.name ~ '__form--' ~ pefixForJs,
                        'trigger-selector': '.js-' ~ config.name ~ '__trigger',
                        'class-to-toggle': 'is-hidden'
                    }
                } only %}
            {% endif %}
        </div>
    {% endif %}
{% endblock %}
