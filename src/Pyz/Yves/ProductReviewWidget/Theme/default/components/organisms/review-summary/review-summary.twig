{% extends model('component') %}

{% define config = {
    name: 'review-summary',
    tag: 'section'
} %}

{% define data = {
    reviews: required,
    summary: required,
    ratingMaxValue: required,
    hasCustomer: required,
    idProductAbstract: required,

    pagination: {
        parameters: required,
        currentPage: required,
        paginationPath: required,
        maxPage: required,
        showAlwaysFirstAndLast: true,
        anchor: 'product-reviews'
    }
} %}

{% block body %}
    <h2 class="review-summary__title">{{ 'product_review.summary.title' | trans }}</h2>

    <div class="grid grid--justify grid--gap">
        <div class="col col--sm-5">
            <h3 class="review-summary__sub-title">{{ 'product_review.product_ratings' | trans }}</h3>

            <div class="review-summary__rating-box grid grid--middle grid--justify">
                <div class="col">
                    {% include molecule('review-average-display', 'ProductReviewWidget') with {
                        data: {
                            summary: data.summary,
                            ratingMaxValue: data.ratingMaxValue
                        }
                    } only %}
                </div>

                <div class="col">
                    {% include molecule('review-distribution-display', 'ProductReviewWidget') with {
                        data: {
                            summary: data.summary
                        }
                    } only %}
                </div>
            </div>

            {% include molecule('toggler-click') with {
                attributes: {
                    'trigger-selector': '.js-review__new-review-trigger, .js-review__new-review-trigger-cancel',
                    'target-selector': '.js-review__new-review-form-target, .js-review__new-review-trigger',
                    'class-to-toggle': 'is-hidden'
                }
            } only %}

            {% include molecule('toggler-hash') with {
                attributes: {
                    'trigger-hash': '#review',
                    'target-selector': '.js-review__new-review-form-target',
                    'class-to-toggle': 'is-hidden',
                    'add-class-when-hash-in-url': false
                }
            } only %}

            {% if is_granted('ROLE_USER') %}
                <a id="review"></a>
                <button class="button float-right spacing-y spacing-y--big js-review__new-review-trigger">
                    {{ 'product_review.submit.add_a_review' | trans }}
                </button>

                <div class="is-hidden js-review__new-review-form-target">
                    {{ render(path('product-review/submit', {'idProductAbstract': data.idProductAbstract})) }}
                </div>
            {% else %}
                <a class="button spacing-y spacing-y--big float-right" href="{{ path('login') }}">
                    {{ 'product_review.submit.add_a_review' | trans }}
                </a>
            {% endif %}

        </div>

        <div class="col col--sm-6">
            <h3 class="review-summary__sub-title">{{ 'product_review.product_reviews' | trans }}</h3>

            {% if data.reviews is empty %}
                <p>{{ 'product_review.no_reviews' | trans }}</p>
            {% else %}
                {% if data.summary.totalReview > 0 %}
                    {% for review in data.reviews %}
                        {% include molecule('review', 'ProductReviewWidget') with {
                            data: {
                                summary: review.summary,
                                ratingValue: review.rating,
                                ratingMaxValue: data.ratingMaxValue,
                                nickname: review.nickname,
                                createdAt: review.createdAt | formatDateTime,
                                description: review.description
                            }
                        } only %}
                    {% endfor %}

                    {% include molecule('pagination') with {
                        data: data.pagination
                    } only %}
                {% endif %}
            {% endif %}
        </div>

    </div>
{% endblock %}
