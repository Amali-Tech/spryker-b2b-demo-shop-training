{% extends model('component') %}

{% define config = {
    name: 'order-detail-product-packaging-unit',
    tag: 'tr'
} %}

{% define data = {
    parentSelector: required,
    item: required,
    currencyIsoCode: required
} %}

{% block body %}
    {% set isBundle = data.item.bundleItems is defined %}
    {% set concreteItem = data.item.bundleProduct | default(data.item) %}

    {% if concreteItem.amount is not null and concreteItem.quantity is not null %}
        {% set salesUnitName = concreteItem.quantitySalesUnit.productMeasurementUnit.name | default('') %}
        {% set salesUnitSummary = '' %}
        {% if salesUnitName %}
            {% set salesUnitSummary = concreteItem.quantity / concreteItem.quantitySalesUnit.conversion ~ ' ' ~ salesUnitName | trans %}
        {% endif %}

        {% set amountSalesUnitName = concreteItem.amountSalesUnit.productMeasurementUnit.name | default('') %}
    {% endif %}
    <td class="{{ data.parentSelector }}__cell transform-cell transform-cell--alt" data-content="{{ 'customer.order.item_sku' | trans }}">
        {{ concreteItem.sku }}
    </td>
    <td class="{{ data.parentSelector }}__cell transform-cell transform-cell--alt" data-content="{{ 'customer.order.product_name' | trans }}">
        <span class="{{ data.parentSelector }}__inner">
            {{ concreteItem.name }}<br>
            {% if concreteItem.amount and concreteItem.quantity %}
                <span class="{{ data.parentSelector }}__text {{ data.parentSelector }}__inner--lg-inline">
                    <span class="text-secondary">&times;</span> {{ concreteItem.amount }} {{ 'packaging_units.cart.item' | trans }} (= {{ concreteItem.amount / concreteItem.amountSalesUnit.conversion }}{{ amountSalesUnitName | trans }}) = {{ concreteItem.quantity * concreteItem.amount }} {{ 'packaging_units.cart.item' | trans }}
                </span>
            {% endif %}
        </span>
    </td>
    <td class="{{ data.parentSelector }}__cell transform-cell transform-cell--alt" data-content="{{ 'customer.order.item_price' | trans }}">
        {{ concreteItem.unitPrice | money(true, data.currencyIsoCode) }}
    </td>
    <td class="{{ data.parentSelector }}__cell transform-cell transform-cell--alt" data-content="{{ 'customer.order.item_quantity' | trans }}">
        {{ concreteItem.quantity }} {% if salesUnitSummary is defined and salesUnitSummary is not empty %}(={{ salesUnitSummary }}){% endif %}
    </td>
    <td class="{{ data.parentSelector }}__cell transform-cell transform-cell--alt" data-content="{{ 'customer.order.item_sum' | trans }}">
        {{ concreteItem.unitPriceToPayAggregation | money(true, data.currencyIsoCode) }}
    </td>
    {% if isBundle %}
        <td class="{{ data.parentSelector }}__cell transform-cell transform-cell--alt transform-cell--no-label is-hidden-lg-xxl" colspan="5">
            <div class="{{ data.parentSelector }}__inner">
                <span class="{{ data.parentSelector }}__title">{{ "customer.order.bundled_items" | trans }} </span>
                {% for bundledItem in data.item.bundleItems %}
                    - {{ bundledItem.quantity }} x {{ bundledItem.name }} <br>
                {% endfor %}

                {% if concreteItem.productOptions is not empty %}
                    {{ "customer.order.options" | trans }} <br>
                    {% for productOption in concreteItem.productOptions %}
                        - {{ productOption.value | trans }} {{ productOption.sumPrice | money(true, data.currencyIsoCode) }}  <br>
                    {% endfor %}
                {% endif %}
            </div>
        </td>
    {% else %}
        {% if concreteItem.productOptions is not empty %}
            <td class="{{ data.parentSelector }}__cell transform-cell transform-cell--alt transform-cell--no-label is-hidden-lg-xxl" colspan="5">
                <div class="{{ data.parentSelector }}__inner">
                    <span class="{{ data.parentSelector }}__title">{{ "customer.order.item_options" | trans }}:</span>
                    <ul>
                        {% for productOption in concreteItem.productOptions %}
                            <li>+&nbsp;{{ productOption.value | trans }} {{ productOption.sumPrice | money(true, data.currencyIsoCode) }}</li>
                        {% endfor %}
                    </ul>
                </div>
            </td>
        {% endif %}
    {% endif %}
    {% if concreteItem.cartNote is not empty %}
        <td class="{{ data.parentSelector }}__cell transform-cell transform-cell--alt transform-cell--no-label is-hidden-lg-xxl" colspan="5">
            {% include molecule('note-list', 'CartNoteWidget') ignore missing with {
                modifiers: ['order-detail'],
                data: {
                    label: 'cart_note.customer_page.item_note',
                    note: concreteItem.cartNote
                }
            } only %}
        </td>
    {% endif %}
{% endblock body %}
