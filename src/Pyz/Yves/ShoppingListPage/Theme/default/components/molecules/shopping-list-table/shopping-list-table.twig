{% extends model('component') %}

{% define config = {
    name: 'shopping-list-table',
    tag: 'table'
} %}

{% define data = {
    shoppingList: required,
    shoppingListItems: required
} %}

{% block body %}

    <div class="grid grid--bottom">
        <div class="col col--sm-12">
            {% for item in data.shoppingListItems %}
                {% set isItemAvailable = item.available is defined and item.available and item.price is defined and item.price is not null %}
                {% if widgetExists('ProductDiscontinuedWidgetPlugin') %}
                    {% set isDiscontinued = widgetBlock('ProductDiscontinuedWidgetPlugin', 'isDiscontinued', item.sku) %}
                    {% set isItemAvailable = not isDiscontinued and isItemAvailable %}
                {% endif %}
                {% embed molecule('cart-item', 'CartPage') with {
                    data: {
                        cart: data.shoppingList,
                        cartItem: item,
                        attributes: data.attributes[item.sku] | default([]),
                        isShoppingList: true,
                        isItemAvailable: isItemAvailable
                    }
                } only %}
                    {% block body %}
                        <div class="grid grid--stretch grid--gap">
                            <div class="{{ config.name }}__col {{ config.name }}__col--image col col--sm-12 col--lg-3">
                                <input class="{{ config.name }}__checkbox" type="checkbox" {{ data.isItemAvailable ? '' : 'disabled' }} name="shoppingListItem[idShoppingListItem][{{ data.cartItem.idShoppingListItem }}]" value="{{ data.cartItem.idShoppingListItem }}"/>
                                <a href="{{ data.cartItem.url }}" class="{{ config.name }}__image ">
                                    {% include molecule('cart-image', 'CartPage') with {
                                        data: {
                                            name: data.cartItem.name | default(''),
                                            image: data.cartItem.images is empty ? null : (data.cartItem.images | first)
                                        }
                                    } only %}
                                </a>
                            </div>
                            <div class="{{ config.name }}__col {{ config.name }}__col--content col col--sm-12 col--lg-6">
                                {% if data.isItemAvailable %}
                                    <span class="{{ config.name }}__available">
                                        {{ 'customer.account.shopping_list.available' | trans }}
                                    </span>
                                {% else %}
                                    <span class="{{ config.name }}__available">
                                        {% if widgetExists('ProductDiscontinuedWidgetPlugin') %}
                                            {{ widget('ProductDiscontinuedWidgetPlugin', data.cartItem.sku) }}
                                        {% else %}
                                            {{ 'customer.account.shopping_list.not_available' | trans }}
                                        {% endif %}
                                    </span>
                                {% endif %}

                                {% if data.cartItem.name is not empty %}
                                    <h6 class="{{ config.name }}__title">
                                        <a href="{{ data.cartItem.url }}" class="{{ config.name }}__title">{{ data.cartItem.name }}</a>
                                    </h6>
                                {% endif %}

                                {% if data.cartItem.sku is not empty %}
                                    <small class="text-secondary grid spacing-bottom spacing-bottom--big">
                                        {{ 'cart.item.sku' | trans }}:
                                        {{ data.cartItem.sku }}
                                    </small>
                                {% endif %}

                                <div class="spacing-bottom spacing-bottom--big">
                                    {% for attribute in data.cartItem.superAttributesDefinition %}
                                        {% if data.cartItem.attributes[attribute] is defined %}
                                            <strong>{{ ('product.attribute.'~attribute) | trans }}: </strong>
                                            {% if ('product.attribute.'~attribute) | trans == 'Color' %}
                                                <small class="{{ config.name}}__color text-secondary" style="background-color: {{ data.cartItem.attributes[attribute] }}">
                                                    {{ data.cartItem.attributes[attribute] }} <br/>
                                                </small>
                                            {% else %}
                                                <small class="text-secondary">
                                                    {{ data.cartItem.attributes[attribute] }} <br/>
                                                </small>
                                            {% endif %}
                                        {% endif %}
                                    {% endfor %}
                                </div>
                            </div>
                            <div class="{{ config.name }}__col {{ config.name }}__col--total col col--sm-12 col--lg-3">
                                <div class="{{ config.name }}__inner--total grid grid--column grid--justify-column grid--bottom">
                                    <div class="col">
                                        {% if data.cartItem.price is not null %}
                                            {% include molecule('price') with {
                                                modifiers: ['block'],
                                                class: 'spacing-bottom spacing-bottom--big',
                                                data: {
                                                    amount: data.cartItem.price | money,
                                                    originalAmount: data.cartItem.prices.ORIGINAL is not defined or data.cartItem.prices.ORIGINAL is empty ? null : (data.cartItem.prices.ORIGINAL | money)
                                                }
                                            } only %}
                                        {% else %}
                                            {{ 'product_alternative_widget.not_applicable' | trans }}
                                        {% endif %}

                                        <input class="{{ config.name }}--fixed-input input" {{ data.isItemAvailable ? '' : 'disabled' }} type="number" name="shoppingListItem[quantity][{{ data.cartItem.idShoppingListItem }}]" value="{{ data.cartItem.quantity }}"/>
                                    </div>
                                    <div class="col">
                                        {% if data.isItemAvailable %}
                                            <button type="submit" name="add-item" class="button button--hollow button--success" value="{{ data.cartItem.idShoppingListItem }}" {{qa('submit-button')}}>
                                                {{'customer.account.shopping_list.add-to-cart' | trans}}
                                            </button>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endblock %}
                {% endembed %}
                {% if can('WriteShoppingListPermissionPlugin', data.shoppingList.idShoppingList) and widgetExists('ProductAlternativeWidgetPlugin') %}
                    {{ widget('ProductAlternativeWidgetPlugin', item, data.shoppingList) }}
                {% endif %}
            {% endfor %}
        </div>
    </div>
{% endblock %}
