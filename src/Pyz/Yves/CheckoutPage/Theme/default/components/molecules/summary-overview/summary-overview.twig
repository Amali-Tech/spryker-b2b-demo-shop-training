{% extends molecule('summary-overview', '@SprykerShop:CheckoutPage') %}

{% define config = {
    name: 'summary-overview',
} %}

{% macro itemDiscounts(discounts, title, configName) %}
    {% if discounts | length %}
        <li class="{{ configName }}__item">
            <span class="{{ configName }}__text {{ configName }}__text--bigger">{{ title | trans }}</span>

            {% for discount in discounts %}
                <div class="{{ configName }}__text-wrap grid grid--justify grid--middle">
                    <span class="{{ configName }}__text col col--sm-8 col--lg-10 text-secondary">{{ discount.displayName }}</span>
                    <span class="{{ configName }}__text {{ configName }}__text--bigger col col--expand text-right text-alt">- {{ discount.amount | money }}</span>
                </div>
            {% endfor %}
        </li>
    {% endif %}
{% endmacro %}

{% block body %}
    <div class="{{ config.name }}__top grid grid--justify grid--middle">
        <div class="col col--sm-8">
            <h6 class="{{ config.name }}__title">{{ 'checkout.step.summary.overview' | trans }}</h6>
        </div>
        <div class="col col--expand text-right">{{ cartQuantity }} {{ 'checkout.step.summary.items' | trans }}</div>
    </div>

    <ul class="{{ config.name }}__list">
        <li class="{{ config.name }}__item">
            <span class="{{ config.name }}__text {{ config.name }}__text--bigger float-right">{{ data.prices.subTotal | money }}</span>
            <span class="{{ config.name }}__text {{ config.name }}__text--bigger">{{ 'checkout.step.summary.sub_total' | trans }}</span>
        </li>

        <li class="{{ config.name }}__item">
            <span class="float-right">{{ data.totalCosts | money }}</span>
            <span class="{{ config.name }}__text {{ config.name }}__text--bigger">{{ 'checkout.step.summary.shipment_costs_total' | trans }}</span>

            {% for shipmentGroup in data.shipmentGroups %}
                {% set shipmentCosts = shipmentGroup.shipment.method %}

                <div class="{{ config.name }}__text-wrap grid grid--justify grid--middle">
                    <span class="{{ config.name }}__text col col--sm-8 col--lg-10 text-secondary">{{ shipmentCosts.carrierName }} - {{ shipmentCosts.name }}</span>
                    <span class="{{ config.name }}__text {{ config.name }}__text--bigger col col--expand text-secondary text-right">{{ shipmentCosts.storeCurrencyPrice | money }}</span>
                </div>
            {% endfor %}
        </li>

        {% if data.prices.discountTotal %}
            {{ _self.itemDiscounts(data.voucherDiscounts, 'cart.vouchers', config.name) }}
            {{ _self.itemDiscounts(data.cartRuleDiscounts, 'cart.discounts', config.name) }}
        {% endif %}

        {% if widgetExists('SalesOrderThresholdWidgetPlugin') %}
            {{ widget('SalesOrderThresholdWidgetPlugin', data.expenses) }}
        {% endif %}

        <li class="{{ config.name }}__item">
            <span class="float-right">{{ data.prices.tax | money }}</span>
            <span class="{{ config.name }}__text {{ config.name }}__text--bigger">{{ 'checkout.step.summary.tax' | trans }}</span>
        </li>

        <li class="{{ config.name }}__item {{ config.name }}__item--total">
            <strong class="float-right {{ config.name }}__title {{ config.name }}__title--total">{{ data.prices.grandTotal | money }}</strong>
            <h6 class="{{ config.name }}__title {{ config.name }}__title--total">{{ 'checkout.step.summary.grand_total' | trans }}</h6>
        </li>
    </ul>
{% endblock %}
