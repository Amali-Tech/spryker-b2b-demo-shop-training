{% extends model('component') %}

{% define config = {
    name: 'cart-item',
    tag: 'article'
} %}

{% define data = {
    cart: required,
    cartItem: required,
    attributes: required,
    isShoppingList: false
} %}

{% if not data.isShoppingList %}
    {% set canEditCart = (not is_granted('IS_AUTHENTICATED_FULLY') or can('WriteSharedCartPermissionPlugin', data.cart.idQuote)) %}
    {% set cartItemSubTotal = data.cartItem.quantity * data.cartItem.unitPrice %}
{% endif %}

{% block body %}
    <div class="grid grid--stretch grid--gap">
        <div class="{{ config.name }}__col {{ config.name }}__col--image col col--sm-12 col--lg-3">
            <a href="{{ data.cartItem.url }}" class="{{ config.name }}__image ">
            {% include molecule('cart-image', 'CartPage') with {
                data: {
                    name: data.cartItem.name | default(''),
                    image: data.cartItem.images is empty ? null : (data.cartItem.images | first)
                }
            } only %}
            </a>
        </div>

        <div class="{{ config.name }}__col {{ config.name }}__col--content col col--sm-12 col--lg-6">
            <h6 class="{{ config.name }}__title">
                <a href="{{ data.cartItem.url }}" class="{{ config.name }}__title">{{ data.cartItem.name }}</a>
            </h6>

            <small class="text-secondary">
                {{ 'cart.item.sku' | trans }}
                {{ data.cartItem.sku }}
            </small>

            {% if data.attributes is not empty %}
                {% include molecule('cart-item-variant-selector', 'CartPage') with {
                    data: {
                        cartItem: data.cartItem,
                        cartItemAttributes: data.attributes
                    }
                } only %}
            {% endif %}

            {{ widget('ProductBundleItemsWidgetPlugin', data.cartItem, data.cart) }}

            {{ widget('CartNoteQuoteItemWidgetPlugin', data.cartItem, data.cart) }}

            {% include molecule('cart-item-summary', 'CartPage') with {
                data: {
                    unitPrice: data.cartItem.unitPrice | money,
                    subtotalPrice: data.cartItem.sumSubtotalAggregation | money,
                    cartItem: data.cartItem
                }
            } only %}

        </div>

        <div class="{{ config.name }}__col {{ config.name }}__col--total col col--sm-12 col--lg-3">
            <div class="{{ config.name }}__inner--total grid grid--column grid--justify-column grid--bottom">
                <div class="col">

                    {% include molecule('price') with {
                        data: {
                            amount: data.cartItem.sumSubtotalAggregation | money,
                        },
                        modifiers: ['cart'],
                    } only %}

                    {{ widget('CartProductPackagingUnitWidgetPlugin', data.cartItem) }}

                    {% if data.cartItem.amountSalesUnit is empty %}
                        {% if widgetExists('QuantitySalesUnitWidgetPlugin') and canEditCart %}
                            {{ widget('QuantitySalesUnitWidgetPlugin', data.cartItem) }}
                        {% else %}
                            {% include molecule('cart-quantity-input', 'CartPage') with {
                                data: {
                                    cartItem: data.cartItem,
                                    readOnly: not canEditCart
                                }
                            } only %}
                        {% endif %}
                    {% endif %}
                </div>

                {% if canEditCart %}
                    <div class="col">
                        <a class="link link--icon" href="{{ path('cart/remove', {'sku': data.cartItem.sku, 'groupKey': data.cartItem.groupKey }) }}">
                            {% include atom('icon') with {
                                modifiers: ['link'],
                                data: {
                                    name: 'delete'
                                }
                            } only %}
                            {{ 'cart.delete.item' | trans }}
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
{% endblock %}
