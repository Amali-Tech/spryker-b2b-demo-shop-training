{% extends model('component') %}

{% define config = {
    name: 'cart-sidebar',
} %}

{% define data = {
    cart: required,
    cartItems: required,
    transformedCartItems: required,
    isQuoteEditable: required,
    isQuoteValid: required,
} %}

{% block class %}
    {{ parent() }} {{ config.jsName }}
{% endblock %}

{% block body %}
    {% block cartNote %}
        {% widget 'CartNoteFormWidget' args [data.cart] only %}
            {% block body %}
                <div class="cart-sidebar__item cart-sidebar__item--note">
                    <h5 class="cart-sidebar__title toggler-accordion__item js-cart-sidebar__trigger" data-toggle-target='.js-cart-sidebar__content-note'>
                        {{ 'cart_note.quote_form.enter_note' | trans }}
                        <span class="icon icon--toggler-cross toggler-accordion__icon"></span>
                    </h5>
                    <div class="cart-sidebar__content js-cart-sidebar__content-note is-hidden">
                        {{ parent() }}
                    </div>
                </div>
            {% endblock %}
        {% endwidget %}
    {% endblock %}

    {% if data.isQuoteEditable and can('ChangeCartItemPermissionPlugin') %}
        {% if data.cart.idQuote is not empty and data.cart.items is not empty %}
            {% widget 'CreateShoppingListFromCartWidget' args [data.cart.idQuote] only %}
                {% block body %}
                    <div class="cart-sidebar__item">
                        <h5 class="cart-sidebar__title toggler-accordion__item js-cart-sidebar__trigger" data-toggle-target='.js-cart-sidebar__content-shopping-list'>
                            {{ 'cart.add-to-shopping-list' | trans }}
                            <span class="icon icon--toggler-cross toggler-accordion__icon"></span>
                        </h5>
                        <div class="cart-sidebar__content js-cart-sidebar__content-shopping-list is-hidden">
                            {{ parent() }}
                        </div>
                    </div>
                {% endblock %}
            {% endwidget %}
        {% endif %}
    {% endif %}

    {% if data.isQuoteEditable %}
        {% widget 'ProductConcreteAddWidget' args [
            '',
            'cart.quick_add_to_cart.submit' | trans,
            'cart/quick-add',
            true,
        ] only %}
            {% block body %}
                <div class="cart-sidebar__item">
                    <h5 class="cart-sidebar__title toggler-accordion__item js-cart-sidebar__trigger" data-toggle-target='.js-cart-sidebar__content-quick-add-widget'>
                        {{ 'cart.quick_add_to_cart' | trans}}
                        <span class="icon icon--toggler-cross toggler-accordion__icon"></span>
                    </h5>
                    <div class="cart-sidebar__content js-cart-sidebar__content-quick-add-widget is-hidden">
                        {{ parent() }}
                    </div>
                </div>
            {% endblock %}
        {% endwidget %}

        {% widget 'ShareCartByLinkWidget' args [data.cart] only %}
            {% block body %}
                <div class="cart-sidebar__item cart-sidebar__item--with-label cart-sidebar__item--shadow-less">
                    <h5 class="cart-sidebar__title toggler-accordion__item js-cart-sidebar__trigger" data-toggle-target='.js-cart-sidebar__content-share-by-link-widget'>
                        {{ 'persistent_cart_share.title' | trans}}
                        <span class="icon icon--toggler-cross toggler-accordion__icon"></span>
                    </h5>
                    <div class="cart-sidebar__content js-cart-sidebar__content-share-by-link-widget is-hidden">
                        {{ parent() }}
                    </div>
                </div>
            {% endblock %}
        {% endwidget %}
    {% endif %}

    {{ block('commentThreadWidget') }}

    <div class="cart-sidebar__item cart-sidebar__item--summary">
        <div class="cart-sidebar__item cart-sidebar__item--start">
            <div class=" grid grid--justify grid--middle cart-sidebar__order">
                <h6 class="col cart-sidebar__title">{{ 'cart.your-order' | trans }}</h6>
                <div class="col cart-sidebar__quantity">{{ data.transformedCartItems | length }} {{ 'checkout.step.summary.items' | trans }}</div>
            </div>

            {% if data.isQuoteEditable and can('ChangeCartItemPermissionPlugin') and can('SeePricePermissionPlugin') %}
                {% widget 'DiscountVoucherFormWidget' only %}{% endwidget %}
            {% endif %}
        </div>

        {% block cartSummary %}
            {% if can('SeePricePermissionPlugin') %}
                {% include molecule('cart-summary', 'CartPage') with {
                    data: {
                        cart: data.cart,
                        isQuoteValid: data.isQuoteValid,
                        isQuoteEditable: data.isQuoteEditable,
                    },
                } only %}
            {% endif %}
        {% endblock %}
    </div>

    {% widget 'QuoteRequestAgentOverviewWidget' only %}
        {% block body %}
            {% block activeRequest %}
                {% if data.quoteRequestOverviewCollection.currentQuoteRequest %}
                    <div class="cart-sidebar__item--summary">
                        {{ block('activeRequestActions') }}
                    </div>
                {% endif %}
            {% endblock %}
        {% endblock %}
    {% endwidget %}

    {% include molecule('toggler-accordion') with {
        attributes: {
            'wrap-selector': '.js-cart-sidebar',
            'trigger-selector': '.js-cart-sidebar__trigger',
            'class-to-toggle': 'is-hidden',
        },
    } only %}
{% endblock %}
